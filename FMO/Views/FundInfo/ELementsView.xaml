<UserControl
    x:Class="FMO.ElementsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:FMO"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DataContext="{d:DesignInstance Type=local:ElementsViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ControlTemplate x:Key="Element" TargetType="ContentControl">
            <DockPanel>
                <TextBlock VerticalAlignment="Center" Text="{Binding Label}" />
                <Button
                    x:Name="btn"
                    hc:IconElement.Geometry="{StaticResource f.circle-check}"
                    Command="{Binding DataContext.ModifyCommand, RelativeSource={RelativeSource AncestorType=local:ElementsView}}"
                    CommandParameter="{Binding .}"
                    DockPanel.Dock="Right" />
                <ContentPresenter
                    Margin="4,0"
                    VerticalAlignment="Center"
                    Content="{TemplateBinding Content}" />
            </DockPanel>
            <ControlTemplate.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <MultiBinding Converter="{StaticResource ValueIsSameConverter}">
                            <Binding Path="OldValue" />
                            <Binding Path="Data" />
                        </MultiBinding>
                    </DataTrigger.Binding>
                    <Setter TargetName="btn" Property="Visibility" Value="Collapsed" />
                </DataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </UserControl.Resources>

    <StackPanel>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>
            <ContentControl DataContext="{Binding FullName}" Template="{StaticResource Element}">
                <TextBox Text="{Binding Data, UpdateSourceTrigger=PropertyChanged, Delay=100}" />
            </ContentControl>

            <ContentControl
                Grid.Column="1"
                DataContext="{Binding ShortName}"
                Template="{StaticResource Element}">
                <TextBox Text="{Binding Data, UpdateSourceTrigger=PropertyChanged, Delay=100}" />
            </ContentControl>
        </Grid>

        <DockPanel Margin="0,5" LastChildFill="False">
            <ContentControl DataContext="{Binding RiskLevel}" Template="{StaticResource Element}">
                <ComboBox ItemsSource="{Binding Source={x:Static local:ElementsViewModel.RiskLevels}}" SelectedItem="{Binding Data}" Width="60"/>
            </ContentControl>
            <ContentControl
                Margin="8,0"
                DataContext="{Binding DurationInMonths}"
                Template="{StaticResource Element}">
                <TextBox
                    Width="50"
                    HorizontalContentAlignment="Center"
                    Text="{Binding Data, UpdateSourceTrigger=PropertyChanged, Delay=100}" />
            </ContentControl>

            <ContentControl
                Margin="8,0"
                DataContext="{Binding ExpirationDate}"
                Template="{StaticResource Element}">
                <DatePicker Width="120" SelectedDate="{Binding Data, UpdateSourceTrigger=PropertyChanged, Delay=100, Converter={StaticResource DataTimeDateOnlySwitchConverter}}" />
            </ContentControl>
        </DockPanel>



    </StackPanel>
</UserControl>
