<UserControl
    x:Class="FMO.CustomerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:FMO"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shared="clr-namespace:FMO.Shared;assembly=FMO.Shared"
    Width="600"
    d:DataContext="{d:DesignInstance Type=local:CustomerViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>

        <SolidColorBrush x:Key="LabelBrush">Gray</SolidColorBrush>
        <Style
            x:Key="SaveElement"
            BasedOn="{StaticResource ButtonBaseStyle}"
            TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="18" />
            <Setter Property="Height" Value="18" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="hc:IconElement.Geometry" Value="{StaticResource f.circle-check}" />
            <Setter Property="hc:IconElement.Width" Value="15" />
            <Setter Property="Visibility" Value="{Binding CanConfirm, Converter={StaticResource Boolean2VisibilityConverter}}" />
            <Setter Property="Command" Value="{Binding DataContext.ModifyCommand, RelativeSource={RelativeSource AncestorType=local:CustomerView}}" />
            <Setter Property="CommandParameter" Value="{Binding .}" />
        </Style>
        <Style
            x:Key="DeleteElement"
            BasedOn="{StaticResource ButtonBaseStyle}"
            TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Foreground" Value="Red" />
            <Setter Property="Width" Value="14" />
            <Setter Property="Height" Value="14" />
            <Setter Property="Padding" Value="1" />
            <Setter Property="hc:IconElement.Geometry" Value="{StaticResource f.xmark}" />
            <Setter Property="Visibility" Value="{Binding CanDelete, Converter={StaticResource Boolean2VisibilityConverter}}" />
            <Setter Property="Command" Value="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=local:CustomerView}}" />
            <Setter Property="CommandParameter" Value="{Binding .}" />
        </Style>
        <Style
            x:Key="ResetElement"
            BasedOn="{StaticResource ButtonBaseStyle}"
            TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Foreground" Value="Blue" />
            <Setter Property="Width" Value="16" />
            <Setter Property="Height" Value="16" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="hc:IconElement.Geometry" Value="{StaticResource f.rotate-left}" />
            <Setter Property="hc:IconElement.Width" Value="12" />
            <Setter Property="Visibility" Value="{Binding HasUnsavedValue, Converter={StaticResource Boolean2VisibilityConverter}}" />
            <Setter Property="Command" Value="{Binding DataContext.ResetCommand, RelativeSource={RelativeSource AncestorType=local:CustomerView}}" />
            <Setter Property="CommandParameter" Value="{Binding .}" />
        </Style>

        <Style x:Key="ElementContainer" TargetType="ContentControl">
            <Setter Property="Content" Value="{Binding}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContentControl">
                        <DockPanel Background="Transparent" LastChildFill="False">
                            <TextBlock
                                VerticalAlignment="Center"
                                Foreground="{StaticResource LabelBrush}"
                                Text="{Binding Label}" />
                            <local:CopyableControl Margin="10,0,0,0" Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityConverter}}">
                                <TextBlock Text="{Binding Display}" />
                            </local:CopyableControl>


                            <DockPanel Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityReConverter}}">
                                <ContentPresenter
                                    Margin="4,0"
                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Content="{TemplateBinding Content}"
                                    ContentTemplate="{TemplateBinding ContentTemplate}" />

                                <Button Style="{StaticResource ResetElement}" />
                                <Button Style="{StaticResource SaveElement}" />
                                <Grid x:Name="x" Visibility="Collapsed">
                                    <Button Style="{StaticResource DeleteElement}" />
                                </Grid>
                            </DockPanel>
                        </DockPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="x" Property="Visibility" Value="Visible" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="HorizontalContentAlignment" Value="Stretch">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">
                                <DockPanel Background="Transparent">
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        Foreground="{StaticResource LabelBrush}"
                                        Text="{Binding Label}" />
                                    <local:CopyableControl Margin="10,0,0,0" Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityConverter}}">
                                        <TextBlock Text="{Binding Display}" />
                                    </local:CopyableControl>

                                    <DockPanel Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityReConverter}}">
                                        <Button DockPanel.Dock="Right" Style="{StaticResource SaveElement}" />

                                        <Button DockPanel.Dock="Right" Style="{StaticResource ResetElement}" />

                                        <Grid
                                            x:Name="x"
                                            DockPanel.Dock="Right"
                                            Visibility="Collapsed">
                                            <Button Style="{StaticResource DeleteElement}" />
                                        </Grid>

                                        <ContentPresenter
                                            Margin="4,0"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            Content="{TemplateBinding Content}"
                                            ContentTemplate="{TemplateBinding ContentTemplate}" />

                                    </DockPanel>

                                </DockPanel>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="x" Property="Visibility" Value="Visible" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>


        <ControlTemplate x:Key="Element" TargetType="ContentControl">
            <DockPanel Background="Transparent">
                <TextBlock
                    VerticalAlignment="Center"
                    Foreground="{StaticResource LabelBrush}"
                    Text="{Binding Label}" />
                <local:CopyableControl Margin="10,0,0,0" Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityConverter}}">
                    <TextBlock Text="{Binding Display}" />
                </local:CopyableControl>
                <DockPanel Visibility="{Binding DataContext.IsReadOnly, RelativeSource={RelativeSource AncestorType=local:CustomerView}, Converter={StaticResource Boolean2VisibilityReConverter}}">

                    <ContentPresenter
                        Margin="4,0"
                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                        Content="{TemplateBinding Content}" />
                </DockPanel>
            </DockPanel>
        </ControlTemplate>

        <Style
            x:Key="SimpleElement"
            BasedOn="{StaticResource ElementContainer}"
            TargetType="ContentControl">
            <Setter Property="Content">
                <Setter.Value>
                    <TextBox Text="{Binding Data.New, UpdateSourceTrigger=PropertyChanged, Delay=100}" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="SimpleElement.Stretch"
            BasedOn="{StaticResource ElementContainer}"
            TargetType="ContentControl">
            <Setter Property="Content">
                <Setter.Value>
                    <TextBox HorizontalAlignment="Stretch" Text="{Binding Data.New, UpdateSourceTrigger=PropertyChanged, Delay=100}" />
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <DockPanel>

            <StackPanel>

                <ContentControl
                    HorizontalAlignment="Center"
                    DataContext="{Binding Name}"
                    Style="{StaticResource ElementContainer}"
                    TextElement.FontSize="16"
                    TextElement.FontWeight="Black">
                    <TextBox
                        MinWidth="400"
                        Text="{Binding Data.New, UpdateSourceTrigger=PropertyChanged, Delay=100}"
                        TextAlignment="Center" />
                </ContentControl>

                <!--  投资人类型  -->
                <ContentControl Content="{Binding}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate>
                            <DockPanel>
                                <ContentControl DataContext="{Binding EntityType}" Style="{StaticResource ElementContainer}">
                                    <ComboBox
                                        MinWidth="100"
                                        ItemsSource="{x:Static local:CustomerViewModel.EntityTypes}"
                                        SelectedItem="{Binding Data.New}" />
                                </ContentControl>

                                <!--  自然人类型  -->
                                <ContentControl
                                    x:Name="natural"
                                    DataContext="{Binding InvestorNaturalType}"
                                    Style="{StaticResource ElementContainer}"
                                    Visibility="Collapsed">
                                    <ComboBox
                                        MinWidth="100"
                                        ItemsSource="{x:Static local:CustomerViewModel.NaturalTypes}"
                                        SelectedItem="{Binding Data.New}" />
                                </ContentControl>

                                <!--  机构类型  -->
                                <DockPanel x:Name="institution" Visibility="Collapsed">
                                    <DockPanel.Resources>
                                        <CollectionViewSource x:Key="data" Source="{x:Static local:CustomerViewModel.InstitutionTypes}">
                                            <CollectionViewSource.GroupDescriptions>
                                                <PropertyGroupDescription PropertyName="Category" />
                                            </CollectionViewSource.GroupDescriptions>
                                        </CollectionViewSource>
                                    </DockPanel.Resources>

                                    <ContentControl DataContext="{Binding InvestorNaturalType}" Style="{StaticResource ElementContainer}">
                                        <ComboBox
                                            MinWidth="100"
                                            ItemsSource="{Binding Source={StaticResource data}}"
                                            SelectedValue="{Binding Data.New}"
                                            SelectedValuePath="Value">
                                            <ComboBox.GroupStyle>
                                                <GroupStyle>
                                                    <GroupStyle.HeaderTemplate>
                                                        <DataTemplate>
                                                            <Border
                                                                Margin="2"
                                                                Background="White"
                                                                BorderThickness="2">
                                                                <TextBlock
                                                                    Margin="4"
                                                                    FontSize="20"
                                                                    FontWeight="Bold"
                                                                    Text="{Binding Name}" />
                                                            </Border>
                                                        </DataTemplate>
                                                    </GroupStyle.HeaderTemplate>
                                                </GroupStyle>
                                            </ComboBox.GroupStyle>
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Value}" />
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </ContentControl>


                                    <ComboBox ItemsSource="{Binding InvestorType}" />

                                </DockPanel>

                            </DockPanel>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding EntityType.Data.New}" Value="Natural">
                                    <Setter TargetName="natural" Property="Visibility" Value="Visible" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding EntityType.Data.New}" Value="Institution">
                                    <Setter TargetName="institution" Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>






            </StackPanel>

        </DockPanel>

        <!--  查看/编辑 切换  -->
        <ToggleButton
            Grid.Column="2"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            IsChecked="{Binding IsReadOnly}"
            Style="{StaticResource ToggleButtonFlip}">
            <hc:StatusSwitchElement.CheckedElement>
                <Viewbox Width="16" Height="16">
                    <Path Data="{StaticResource f.pen}" Fill="Green" />
                </Viewbox>
            </hc:StatusSwitchElement.CheckedElement>
            <Viewbox Width="18" Height="18">
                <Path Data="{StaticResource f.eye}" Fill="Black" />
            </Viewbox>
        </ToggleButton>
    </Grid>
</UserControl>
